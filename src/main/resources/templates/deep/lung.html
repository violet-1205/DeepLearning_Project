<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/top :: head}">
</head>
<body class="bg-stone-50 dark:bg-stone-900 text-stone-800 dark:text-stone-100 min-h-screen flex flex-col transition-colors duration-200">
    
    <!-- Include Navbar -->
    <div th:replace="~{layout/top :: nav}"></div>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-4xl">
        <h1 class="text-3xl font-bold mb-8 text-center">폐암 수술 후 생존 예측 (Lung Cancer Survival)</h1>

        <div class="bg-white dark:bg-stone-800 shadow-lg rounded-lg p-6 md:p-8 border border-stone-200 dark:border-stone-700">
            <div class="mb-6 text-sm text-stone-500 dark:text-stone-400">
                <p>Python 딥러닝 모델(Keras/TensorFlow)을 실행하여 수술 후 생존 여부를 예측합니다.</p>
                <p>파일명: lung_deep.py | 데이터: ThoraricSurgery3.csv</p>
            </div>

            <form action="/deep/lung/predict" method="post" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <!-- 1. DGN -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">1. 진단명 (DGN)</label>
                        <input type="number" step="any" name="attr1" th:value="${attr1}" required placeholder="예: 2"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 2. FVC -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">2. 폐활량 (FVC)</label>
                        <input type="number" step="any" name="attr2" th:value="${attr2}" required placeholder="예: 2.88"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 3. FEV1 -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">3. 1초 강제호기량 (FEV1)</label>
                        <input type="number" step="any" name="attr3" th:value="${attr3}" required placeholder="예: 2.16"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 4. Performance Status -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">4. 전신 수행 (PRZ)</label>
                        <input type="number" step="any" name="attr4" th:value="${attr4}" required placeholder="예: 1"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 5. Pain -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">5. 통증 (Pain)</label>
                        <input type="number" step="any" name="attr5" th:value="${attr5}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 6. Haemoptysis -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">6. 객혈 (Haemoptysis)</label>
                        <input type="number" step="any" name="attr6" th:value="${attr6}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 7. Dyspnoea -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">7. 호흡곤란 (Dyspnoea)</label>
                        <input type="number" step="any" name="attr7" th:value="${attr7}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 8. Cough -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">8. 기침 (Cough)</label>
                        <input type="number" step="any" name="attr8" th:value="${attr8}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 9. Weakness -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">9. 약화 (Weakness)</label>
                        <input type="number" step="any" name="attr9" th:value="${attr9}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 10. Tumor Size -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">10. 종양 크기 (Size)</label>
                        <input type="number" step="any" name="attr10" th:value="${attr10}" required placeholder="예: 3"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 11. Type 2 DM -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">11. 제2형 당뇨 (DM)</label>
                        <input type="number" step="any" name="attr11" th:value="${attr11}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 12. MI -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">12. 심근경색 (MI)</label>
                        <input type="number" step="any" name="attr12" th:value="${attr12}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 13. PAD -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">13. 말초동맥질환 (PAD)</label>
                        <input type="number" step="any" name="attr13" th:value="${attr13}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 14. Smoking -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">14. 흡연 (Smoking)</label>
                        <input type="number" step="any" name="attr14" th:value="${attr14}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 15. Asthma -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">15. 천식 (Asthma)</label>
                        <input type="number" step="any" name="attr15" th:value="${attr15}" required placeholder="0(F)/1(T)"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                    <!-- 16. Age -->
                    <div>
                        <label class="block text-xs font-medium mb-1 text-stone-700 dark:text-stone-300">16. 나이 (Age)</label>
                        <input type="number" step="any" name="attr16" th:value="${attr16}" required placeholder="예: 60"
                            class="w-full px-3 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm">
                    </div>
                </div>

                <div class="text-center pt-4">
                    <button type="submit" onclick="showLoading()"
                        class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition transform hover:scale-105 focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
                        Python 실행 및 예측 (Run AI)
                    </button>
                </div>
            </form>

            <!-- Loading Overlay -->
            <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex flex-col items-center justify-center">
                <div class="bg-white dark:bg-stone-800 p-8 rounded-lg shadow-2xl flex flex-col items-center max-w-sm w-full mx-4">
                    <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
                    <h3 class="text-xl font-bold text-stone-800 dark:text-stone-100 mb-2">분석 중입니다...</h3>
                    <p class="text-stone-600 dark:text-stone-400 mb-4 text-sm">AI 모델이 데이터를 분석하고 있습니다.</p>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-stone-200 dark:bg-stone-700 rounded-full h-4 mb-2 overflow-hidden">
                        <div id="progressBar" class="bg-blue-600 h-4 rounded-full transition-all duration-300 ease-out" style="width: 0%"></div>
                    </div>
                    <div class="text-right w-full">
                        <span id="progressText" class="text-sm font-semibold text-blue-600 dark:text-blue-400">0%</span>
                    </div>
                </div>
            </div>

            <script>
                function showLoading() {
                    const form = document.querySelector('form');
                    if (form.checkValidity()) {
                        const overlay = document.getElementById('loadingOverlay');
                        const progressBar = document.getElementById('progressBar');
                        const progressText = document.getElementById('progressText');
                        
                        overlay.classList.remove('hidden');
                        
                        let width = 0;
                        const interval = setInterval(() => {
                            if (width >= 99) {
                                clearInterval(interval);
                            } else {
                                // Fast at first, then slower
                                if (width < 30) width += 5;
                                else if (width < 70) width += 2;
                                else width += 0.5;
                                
                                // Cap at 99% until page reload
                                if (width > 99) width = 99;
                                
                                progressBar.style.width = width + '%';
                                progressText.innerText = Math.round(width) + '%';
                            }
                        }, 100);
                    }
                }
            </script>

            <!-- Result Area -->
            <div th:if="${result}" class="mt-8">
                <h3 class="text-lg font-bold mb-3 text-stone-800 dark:text-stone-100 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    실행 결과 (Python Execution Result)
                </h3>
                <div class="p-6 bg-stone-900 text-green-400 rounded-lg shadow-inner font-mono text-sm overflow-x-auto border border-stone-700">
                    <pre class="whitespace-pre-wrap" th:text="${result}"></pre>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <div th:replace="~{layout/footer :: footer}"></div>
</body>
</html>
