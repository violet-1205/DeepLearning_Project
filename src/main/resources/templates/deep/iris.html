<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/top :: head}">
</head>
<body class="bg-stone-50 dark:bg-stone-900 text-stone-800 dark:text-stone-100 min-h-screen flex flex-col transition-colors duration-200">
    
    <!-- Include Navbar -->
    <div th:replace="~{layout/top :: nav}"></div>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-4xl">
        <h1 class="text-3xl font-bold mb-8 text-center">붓꽃 품종 분류 (Deep Learning)</h1>

        <div class="bg-white dark:bg-stone-800 shadow-lg rounded-lg p-6 md:p-8 border border-stone-200 dark:border-stone-700">
            <div class="mb-6 text-sm text-stone-500 dark:text-stone-400">
                <p>Python 딥러닝 모델(Keras/TensorFlow)을 실행하여 붓꽃의 품종을 예측합니다.</p>
                <p>파일명: iris_deep.py | 데이터: iris3.csv</p>
            </div>

            <form action="/deep/iris/predict" method="post" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- 1. Sepal Length -->
                    <div>
                        <label class="block text-sm font-medium mb-1 text-stone-700 dark:text-stone-300">1. 꽃받침 길이 (Sepal Length)</label>
                        <input type="number" step="any" name="sepalLength" th:value="${sepalLength}" required
                            placeholder="예: 5.1"
                            class="w-full px-4 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                    <!-- 2. Sepal Width -->
                    <div>
                        <label class="block text-sm font-medium mb-1 text-stone-700 dark:text-stone-300">2. 꽃받침 너비 (Sepal Width)</label>
                        <input type="number" step="any" name="sepalWidth" th:value="${sepalWidth}" required
                            placeholder="예: 3.5"
                            class="w-full px-4 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                    <!-- 3. Petal Length -->
                    <div>
                        <label class="block text-sm font-medium mb-1 text-stone-700 dark:text-stone-300">3. 꽃잎 길이 (Petal Length)</label>
                        <input type="number" step="any" name="petalLength" th:value="${petalLength}" required
                            placeholder="예: 1.4"
                            class="w-full px-4 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                    <!-- 4. Petal Width -->
                    <div>
                        <label class="block text-sm font-medium mb-1 text-stone-700 dark:text-stone-300">4. 꽃잎 너비 (Petal Width)</label>
                        <input type="number" step="any" name="petalWidth" th:value="${petalWidth}" required
                            placeholder="예: 0.2"
                            class="w-full px-4 py-2 rounded-md border border-stone-300 dark:border-stone-600 bg-white dark:bg-stone-700 text-stone-900 dark:text-white focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                </div>

                <div class="text-center pt-4">
                    <button type="submit" onclick="showLoading()"
                        class="px-8 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow-md transition transform hover:scale-105 focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50">
                        Python 실행 및 예측 (Run AI)
                    </button>
                </div>
            </form>

            <!-- Loading Overlay -->
            <div id="loadingOverlay" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex flex-col items-center justify-center">
                <div class="bg-white dark:bg-stone-800 p-8 rounded-lg shadow-2xl flex flex-col items-center max-w-sm w-full mx-4">
                    <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin mb-4"></div>
                    <h3 class="text-xl font-bold text-stone-800 dark:text-stone-100 mb-2">분석 중입니다...</h3>
                    <p class="text-stone-600 dark:text-stone-400 mb-4 text-sm">AI 모델이 데이터를 분석하고 있습니다.</p>
                    
                    <!-- Progress Bar -->
                    <div class="w-full bg-stone-200 dark:bg-stone-700 rounded-full h-4 mb-2 overflow-hidden">
                        <div id="progressBar" class="bg-blue-600 h-4 rounded-full transition-all duration-300 ease-out" style="width: 0%"></div>
                    </div>
                    <div class="text-right w-full">
                        <span id="progressText" class="text-sm font-semibold text-blue-600 dark:text-blue-400">0%</span>
                    </div>
                </div>
            </div>

            <script>
                function showLoading() {
                    const form = document.querySelector('form');
                    if (form.checkValidity()) {
                        const overlay = document.getElementById('loadingOverlay');
                        const progressBar = document.getElementById('progressBar');
                        const progressText = document.getElementById('progressText');
                        
                        overlay.classList.remove('hidden');
                        
                        let width = 0;
                        const interval = setInterval(() => {
                            if (width >= 99) {
                                clearInterval(interval);
                            } else {
                                // Fast at first, then slower
                                if (width < 30) width += 5;
                                else if (width < 70) width += 2;
                                else width += 0.5;
                                
                                // Cap at 99% until page reload
                                if (width > 99) width = 99;
                                
                                progressBar.style.width = width + '%';
                                progressText.innerText = Math.round(width) + '%';
                            }
                        }, 100);
                    }
                }
            </script>

            <!-- Result Area -->
            <div th:if="${result}" class="mt-8">
                <h3 class="text-lg font-bold mb-3 text-stone-800 dark:text-stone-100 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                    실행 결과 (Python Execution Result)
                </h3>
                <div class="p-6 bg-stone-900 text-green-400 rounded-lg shadow-inner font-mono text-sm overflow-x-auto border border-stone-700">
                    <pre class="whitespace-pre-wrap" th:text="${result}"></pre>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <div th:replace="~{layout/footer :: footer}"></div>
</body>
</html>